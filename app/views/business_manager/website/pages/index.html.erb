<% content_for :title, "Website Pages" %>

<div class="space-y-6">
  <!-- Header -->
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Website Builder</h1>
      <p class="text-gray-600 mt-1">Build and customize your professional website</p>
    </div>
    <div class="space-x-3">
      <%= link_to "Show Site", root_url(subdomain: current_business.host_type_subdomain? ? current_business.hostname : nil), 
                  class: "bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors",
                  target: "_blank" %>
      <%= link_to "Create Page", new_business_manager_website_page_path, 
                  class: "bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors" %>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="bg-white border border-gray-200 rounded-lg p-1">
    <nav class="flex space-x-1">
      <%= link_to business_manager_website_pages_path, 
                  class: "px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-500 text-white" do %>
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        Pages
      <% end %>
      
      <%= link_to business_manager_website_templates_path, 
                  class: "px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-900 hover:bg-gray-100" do %>
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
        </svg>
        Templates
      <% end %>
      
      <%= link_to business_manager_website_themes_path, 
                  class: "px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-900 hover:bg-gray-100" do %>
        <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewBox="0 0 325.04 325.04">
          <path d="M117.866,234.088c-2.956,14.532-4.875,21.558-16.092,22.458c-2.764,0.222-5.015,2.308-5.446,5.047 c-0.432,2.738,1.069,5.416,3.631,6.477c0.721,0.298,17.877,7.308,37.921,7.309c0.003,0,0.005,0,0.007,0 c13.968,0,25.95-3.386,35.612-10.063c11.45-7.912,19.344-20.294,23.541-36.788l-38.572-38.88 C125.871,194.924,121.253,217.436,117.866,234.088z"/>
          <path d="M322.745,63.336c-1.037-1.046-2.887-2.293-5.806-2.293c-3.423,0-12.516,0-67.74,46.992 c-25.509,21.706-54.92,48.559-78.314,71.41l36.603,36.894c24.061-25.009,52.129-56.355,74.451-83.258 c14.096-16.986,24.935-31.002,32.216-41.657C323.799,77.311,328.023,68.655,322.745,63.336z"/>
          <path d="M182.595,278.479c-12.387,8.56-27.429,12.899-44.716,12.899c-22.753-0.001-41.919-7.649-44.046-8.527 c-9.425-3.906-14.898-13.673-13.31-23.749c1.555-9.871,9.463-17.373,19.341-18.446c0.861-2.571,1.813-7.254,2.323-9.758 c1.878-9.23,4.449-21.873,12.358-33.126c8.637-12.287,21.656-20.165,38.751-23.466c9.811-9.737,21.005-20.443,32.686-31.308 c-5.905-1.281-11.185-5.127-14.017-10.944c-4.875-10.02-0.623-22.073,9.484-26.895c10.133-4.834,22.287-0.612,27.155,9.423 c0.961,1.978,1.555,4.033,1.832,6.096c9.688-8.677,19.309-17.099,28.392-24.828c0.054-0.046,0.105-0.09,0.16-0.136 c-10.209-19.536-24.849-36.845-42.687-50.098c-25.614-19.031-56.114-29.096-88.2-29.104c-0.01,0-0.017,0-0.025,0 c-21.654,0-47.976,7.566-68.697,19.749C13.981,51.193-0.005,71.163,0,92.49c0.008,25.748,14.53,36.518,26.199,45.171 c9.515,7.057,17.03,12.63,17.034,24.844c0.003,12.213-7.508,17.781-17.018,24.831c-11.665,8.648-26.184,19.412-26.176,45.163 c0.006,21.324,14.001,41.299,39.406,56.244c20.736,12.198,47.072,19.78,68.73,19.786c0.015,0,0.028,0,0.042,0 c39.305,0,76.254-15.171,104.044-42.72c20.837-20.655,34.656-46.416,40.273-74.442c-13.952,15.471-27.997,30.493-40.563,43.322 C206.641,253.965,196.773,268.682,182.595,278.479z M111.054,77.103c2.498-10.871,13.4-17.657,24.354-15.167 c10.939,2.478,17.793,13.282,15.313,24.138c-2.499,10.844-13.407,17.631-24.362,15.154 C115.411,98.764,108.554,87.947,111.054,77.103z M45.054,114.152c-7.005-8.716-5.565-21.401,3.216-28.339 c8.78-6.925,21.571-5.505,28.589,3.195c6.99,8.703,5.545,21.388-3.229,28.34C64.869,124.288,52.058,122.853,45.054,114.152z M55.746,247.168c-8.786-6.944-10.231-19.629-3.226-28.342c7-8.696,19.796-10.122,28.581-3.18 c8.778,6.943,10.224,19.629,3.225,28.327C77.327,252.686,64.53,254.111,55.746,247.168z"/>
        </svg>
        Themes
      <% end %>
    </nav>
  </div>

  <!-- Quick Stats -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="bg-white border border-gray-200 rounded-lg p-4">
      <div class="flex items-center">
        <div class="text-2xl font-bold text-blue-600"><%= @pages.count %></div>
        <div class="ml-2 text-sm text-gray-600">Total Pages</div>
      </div>
    </div>
    <div class="bg-white border border-gray-200 rounded-lg p-4">
      <div class="flex items-center">
        <div class="text-2xl font-bold text-green-600"><%= @pages.published.count %></div>
        <div class="ml-2 text-sm text-gray-600">Published</div>
      </div>
    </div>
    <div class="bg-white border border-gray-200 rounded-lg p-4">
      <div class="flex items-center">
        <div class="text-2xl font-bold text-yellow-600"><%= @pages.draft.count %></div>
        <div class="ml-2 text-sm text-gray-600">Drafts</div>
      </div>
    </div>
    <div class="bg-white border border-gray-200 rounded-lg p-4">
      <div class="flex items-center">
        <div class="text-2xl font-bold text-purple-600"><%= @pages.sum { |p| p.page_sections.count } %></div>
        <div class="ml-2 text-sm text-gray-600">Total Sections</div>
      </div>
    </div>
  </div>

  <!-- Pages Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <% @pages.each do |page| %>
      <div class="bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow">
        <!-- Page Preview -->
        <div class="h-40 bg-gradient-to-br from-gray-50 to-gray-100 rounded-t-lg relative overflow-hidden">
          <div class="absolute inset-0 p-4">
            <!-- Mock page layout -->
            <div class="space-y-2">
              <div class="h-3 bg-gray-300 rounded" style="width: 70%;"></div>
              <div class="space-y-1">
                <div class="h-1 bg-gray-200 rounded" style="width: 90%;"></div>
                <div class="h-1 bg-gray-200 rounded" style="width: 75%;"></div>
                <div class="h-1 bg-gray-200 rounded" style="width: 85%;"></div>
              </div>
              
              <!-- Section indicators -->
              <div class="flex space-x-1 mt-3">
                <% page.page_sections.limit(4).each do |section| %>
                  <div class="w-6 h-4 bg-blue-200 rounded-sm border border-blue-300 flex items-center justify-center">
                    <span class="text-[6px] text-blue-600 font-bold">
                      <%= section.section_type.first.upcase %>
                    </span>
                  </div>
                <% end %>
                <% if page.page_sections.count > 4 %>
                  <div class="w-6 h-4 bg-gray-200 rounded-sm border border-gray-300 flex items-center justify-center">
                    <span class="text-[6px] text-gray-600">+<%= page.page_sections.count - 4 %></span>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
          
          <!-- Status Badge -->
          <div class="absolute top-2 right-2">
            <% if page.published? %>
              <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Published</span>
            <% elsif page.draft? %>
              <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">Draft</span>
            <% else %>
              <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">Archived</span>
            <% end %>
          </div>
        </div>

        <!-- Page Info -->
        <div class="p-4 space-y-3">
          <div>
            <h3 class="font-semibold text-gray-900 flex items-center">
              <%= page.title %>
              <% if page.show_in_menu? %>
                <span class="ml-2 text-xs bg-blue-100 text-blue-600 px-1 rounded">Menu</span>
              <% end %>
            </h3>
            <p class="text-sm text-gray-500">
              /<%= page.slug %>
              <% if page.page_type != 'custom' %>
                • <%= page.page_type.humanize %>
              <% end %>
            </p>
          </div>

          <!-- Section Summary -->
          <div class="text-xs text-gray-600">
            <%= pluralize(page.page_sections.count, 'section') %>
            <% if page.page_sections.any? %>
              • <%= page.page_sections.pluck(:section_type).uniq.join(', ') %>
            <% end %>
          </div>

          <!-- Action Buttons -->
          <div class="flex space-x-2 pt-2">
            <%= link_to "Edit Page", business_manager_website_page_path(page), 
                        class: "flex-1 text-center bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm transition-colors" %>
            <%= link_to "Sections", business_manager_website_page_sections_path(page), 
                        class: "flex-1 text-center bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm transition-colors" %>
                            <%= link_to "Show Page", public_page_url(page), 
                        class: "bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded text-sm transition-colors",
                        target: "_blank" %>
          </div>

          <!-- Additional Info -->
          <div class="flex justify-between items-center pt-2 border-t border-gray-100 text-xs text-gray-500">
            <span>Updated <%= time_ago_in_words(page.updated_at) %> ago</span>
            <div class="flex space-x-2">
              <%= link_to "Settings", edit_business_manager_website_page_path(page), 
                          class: "hover:text-gray-700" %>
              <% unless page.essential_page? %>
                <%= link_to "Delete", business_manager_website_page_path(page), 
                            method: :delete,
                            class: "text-red-500 hover:text-red-700",
                            data: { confirm: "Are you sure? This cannot be undone." } %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Add New Page Card -->
    <div class="bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-colors">
      <%= link_to new_business_manager_website_page_path, class: "flex flex-col items-center justify-center h-full min-h-[280px] text-gray-500 hover:text-blue-600" do %>
        <div class="text-4xl mb-2">+</div>
        <div class="text-sm font-medium">Create New Page</div>
        <div class="text-xs text-gray-400 mt-1">Add a custom page to your website</div>
      <% end %>
    </div>
  </div>
</div>

<script>
// Add some page management functionality
function initializePagesIndexPage() {
  // Add hover effects
  const pageCards = document.querySelectorAll('.bg-white.border.border-gray-200');
  pageCards.forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-2px)';
    });
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
    });
  });
}

// Initialize on both DOMContentLoaded and turbo:load for Turbo compatibility
document.addEventListener('DOMContentLoaded', initializePagesIndexPage);
document.addEventListener('turbo:load', initializePagesIndexPage);
</script> 