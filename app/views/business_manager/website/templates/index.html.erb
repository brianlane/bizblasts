<% content_for :title, "Website Templates" %>

<div class="space-y-6" data-controller="template-browser">
  <!-- Header -->
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Website Builder</h1>
      <p class="text-gray-600 mt-1">Choose from professionally designed templates tailored for your industry</p>
    </div>
    <div class="space-x-3">
      <%= link_to "My Themes", business_manager_website_themes_path, 
                  class: "bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors" %>
      <% if current_business.template_applied.present? %>
        <span class="bg-green-100 text-green-800 px-3 py-2 rounded-lg text-sm">
          ✓ Using: <%= current_business.template_applied %>
        </span>
      <% end %>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="bg-white border border-gray-200 rounded-lg p-1">
    <nav class="flex space-x-1">
      <%= link_to business_manager_website_pages_path, 
                  class: "px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-900 hover:bg-gray-100" do %>
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        Pages
      <% end %>
      
      <%= link_to business_manager_website_templates_path, 
                  class: "px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-500 text-white" do %>
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
        </svg>
        Templates
      <% end %>
      
      <%= link_to business_manager_website_themes_path, 
                  class: "px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-900 hover:bg-gray-100" do %>
        <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewBox="0 0 325.04 325.04">
          <path d="M117.866,234.088c-2.956,14.532-4.875,21.558-16.092,22.458c-2.764,0.222-5.015,2.308-5.446,5.047 c-0.432,2.738,1.069,5.416,3.631,6.477c0.721,0.298,17.877,7.308,37.921,7.309c0.003,0,0.005,0,0.007,0 c13.968,0,25.95-3.386,35.612-10.063c11.45-7.912,19.344-20.294,23.541-36.788l-38.572-38.88 C125.871,194.924,121.253,217.436,117.866,234.088z"/>
          <path d="M322.745,63.336c-1.037-1.046-2.887-2.293-5.806-2.293c-3.423,0-12.516,0-67.74,46.992 c-25.509,21.706-54.92,48.559-78.314,71.41l36.603,36.894c24.061-25.009,52.129-56.355,74.451-83.258 c14.096-16.986,24.935-31.002,32.216-41.657C323.799,77.311,328.023,68.655,322.745,63.336z"/>
          <path d="M182.595,278.479c-12.387,8.56-27.429,12.899-44.716,12.899c-22.753-0.001-41.919-7.649-44.046-8.527 c-9.425-3.906-14.898-13.673-13.31-23.749c1.555-9.871,9.463-17.373,19.341-18.446c0.861-2.571,1.813-7.254,2.323-9.758 c1.878-9.23,4.449-21.873,12.358-33.126c8.637-12.287,21.656-20.165,38.751-23.466c9.811-9.737,21.005-20.443,32.686-31.308 c-5.905-1.281-11.185-5.127-14.017-10.944c-4.875-10.02-0.623-22.073,9.484-26.895c10.133-4.834,22.287-0.612,27.155,9.423 c0.961,1.978,1.555,4.033,1.832,6.096c9.688-8.677,19.309-17.099,28.392-24.828c0.054-0.046,0.105-0.09,0.16-0.136 c-10.209-19.536-24.849-36.845-42.687-50.098c-25.614-19.031-56.114-29.096-88.2-29.104c-0.01,0-0.017,0-0.025,0 c-21.654,0-47.976,7.566-68.697,19.749C13.981,51.193-0.005,71.163,0,92.49c0.008,25.748,14.53,36.518,26.199,45.171 c9.515,7.057,17.03,12.63,17.034,24.844c0.003,12.213-7.508,17.781-17.018,24.831c-11.665,8.648-26.184,19.412-26.176,45.163 c0.006,21.324,14.001,41.299,39.406,56.244c20.736,12.198,47.072,19.78,68.73,19.786c0.015,0,0.028,0,0.042,0 c39.305,0,76.254-15.171,104.044-42.72c20.837-20.655,34.656-46.416,40.273-74.442c-13.952,15.471-27.997,30.493-40.563,43.322 C206.641,253.965,196.773,268.682,182.595,278.479z M111.054,77.103c2.498-10.871,13.4-17.657,24.354-15.167 c10.939,2.478,17.793,13.282,15.313,24.138c-2.499,10.844-13.407,17.631-24.362,15.154 C115.411,98.764,108.554,87.947,111.054,77.103z M45.054,114.152c-7.005-8.716-5.565-21.401,3.216-28.339 c8.78-6.925,21.571-5.505,28.589,3.195c6.99,8.703,5.545,21.388-3.229,28.34C64.869,124.288,52.058,122.853,45.054,114.152z M55.746,247.168c-8.786-6.944-10.231-19.629-3.226-28.342c7-8.696,19.796-10.122,28.581-3.18 c8.778,6.943,10.224,19.629,3.225,28.327C77.327,252.686,64.53,254.111,55.746,247.168z"/>
        </svg>
        Themes
      <% end %>
    </nav>
  </div>

  <!-- Filter Tabs -->
  <div class="bg-white border border-gray-200 rounded-lg p-1">
    <nav class="flex space-x-1">
      <button type="button" 
              class="filter-tab active px-4 py-2 rounded-md text-sm font-medium transition-colors cursor-pointer"
              data-template-browser-target="filterTabs"
              data-action="click->template-browser#filterTemplates"
              data-filter="all">
        All Templates
      </button>
      <button type="button" 
              class="filter-tab px-4 py-2 rounded-md text-sm font-medium transition-colors cursor-pointer"
              data-template-browser-target="filterTabs"
              data-action="click->template-browser#filterTemplates"
              data-filter="universal">
        Universal
      </button>
      <button type="button" 
              class="filter-tab px-4 py-2 rounded-md text-sm font-medium transition-colors cursor-pointer"
              data-template-browser-target="filterTabs"
              data-action="click->template-browser#filterTemplates"
              data-filter="industry">
        My Industry
      </button>
      <% if current_business.premium_tier? %>
        <button type="button" 
                class="filter-tab px-4 py-2 rounded-md text-sm font-medium transition-colors cursor-pointer"
                data-template-browser-target="filterTabs"
                data-action="click->template-browser#filterTemplates"
                data-filter="premium">
          Premium
        </button>
      <% end %>
    </nav>
  </div>

  <!-- Template Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" data-template-browser-target="templateGrid">
    <% @templates.each do |template| %>
      <div class="template-card bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-lg transition-shadow"
           data-template-id="<%= template.id %>"
           data-template-industry="<%= template.industry %>"
           data-template-type="<%= template.template_type %>"
           data-template-premium="<%= template.requires_premium? %>">
        
        <!-- Template Preview -->
        <div class="relative">
          <div class="h-48 bg-gradient-to-br from-gray-50 to-gray-100 rounded-t-lg overflow-hidden">
            <!-- Mock Website Preview -->
            <div class="absolute inset-0 p-4 space-y-3">
              <!-- Header -->
              <div class="h-6 rounded flex items-center space-x-2" 
                   style="background-color: <%= template.default_theme.dig('color_scheme', 'primary') || '#3b82f6' %>;">
                <div class="flex-1 h-2 bg-white bg-opacity-30 rounded ml-3" style="width: 30%;"></div>
                <div class="space-x-1 mr-3">
                  <div class="w-2 h-2 bg-white bg-opacity-30 rounded inline-block"></div>
                  <div class="w-2 h-2 bg-white bg-opacity-30 rounded inline-block"></div>
                  <div class="w-2 h-2 bg-white bg-opacity-30 rounded inline-block"></div>
                </div>
              </div>
              
              <!-- Hero Section -->
              <div class="space-y-2">
                <div class="h-4 bg-gray-300 rounded" style="width: 60%;"></div>
                <div class="h-2 bg-gray-200 rounded" style="width: 80%;"></div>
                <div class="h-2 bg-gray-200 rounded" style="width: 70%;"></div>
              </div>
              
              <!-- Content Sections -->
              <div class="grid grid-cols-3 gap-2 pt-2">
                <div class="space-y-1">
                  <div class="h-2 bg-gray-200 rounded"></div>
                  <div class="h-1 bg-gray-100 rounded"></div>
                  <div class="h-1 bg-gray-100 rounded" style="width: 70%;"></div>
                </div>
                <div class="space-y-1">
                  <div class="h-2 bg-gray-200 rounded"></div>
                  <div class="h-1 bg-gray-100 rounded"></div>
                  <div class="h-1 bg-gray-100 rounded" style="width: 80%;"></div>
                </div>
                <div class="space-y-1">
                  <div class="h-2 bg-gray-200 rounded"></div>
                  <div class="h-1 bg-gray-100 rounded"></div>
                  <div class="h-1 bg-gray-100 rounded" style="width: 60%;"></div>
                </div>
              </div>
              
              <!-- CTA Button -->
              <div class="pt-2">
                <div class="h-3 w-16 rounded" 
                     style="background-color: <%= template.default_theme.dig('color_scheme', 'accent') || '#f59e0b' %>;"></div>
              </div>
            </div>
          </div>

          <!-- Badges -->
          <div class="absolute top-2 left-2 space-y-1">
            <% if template.industry == 'universal' %>
              <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Universal</span>
            <% else %>
              <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">
                <%= Business::SHOWCASE_INDUSTRY_MAPPINGS[template.industry.to_sym] %>
              </span>
            <% end %>
            <% if template.requires_premium? %>
              <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">Premium</span>
            <% end %>
          </div>

          <!-- Overlay Actions -->
          <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center opacity-0 hover:opacity-100">
            <div class="space-x-2">
              <button type="button" 
                      class="bg-white text-gray-900 px-4 py-2 rounded-lg shadow-lg hover:bg-gray-100 transition-colors"
                      data-action="click->template-browser#previewTemplate"
                      data-template-id="<%= template.id %>">
                👁️ Preview
              </button>
              <% if template.can_be_used_by?(current_business) %>
                <button type="button" 
                        class="bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-blue-600 transition-colors"
                        data-action="click->template-browser#applyTemplate"
                        data-template-id="<%= template.id %>">
                  ⚡ Apply
                </button>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Template Info -->
        <div class="p-4 space-y-3">
          <div>
            <h3 class="font-semibold text-gray-900"><%= template.name %></h3>
            <p class="text-sm text-gray-600 mt-1"><%= template.description %></p>
          </div>

          <!-- Color Palette -->
          <div class="space-y-2">
            <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Color Scheme</p>
            <div class="flex space-x-1">
              <% ['primary', 'secondary', 'accent'].each do |color_key| %>
                <% if template.default_theme.dig('color_scheme', color_key) %>
                  <div class="w-6 h-6 rounded-full border-2 border-white shadow-sm" 
                       style="background-color: <%= template.default_theme.dig('color_scheme', color_key) %>;"
                       title="<%= color_key.titleize %>: <%= template.default_theme.dig('color_scheme', color_key) %>">
                  </div>
                <% end %>
              <% end %>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex space-x-2 pt-2">
            <button type="button" 
                    class="flex-1 text-center bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded text-sm transition-colors"
                    data-action="click->template-browser#previewTemplate"
                    data-template-id="<%= template.id %>">
              Preview
            </button>
            
            <% if template.can_be_used_by?(current_business) %>
              <button type="button" 
                      class="flex-1 text-center bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm transition-colors"
                      data-action="click->template-browser#applyTemplate"
                      data-template-id="<%= template.id %>">
                Apply Template
              </button>
            <% else %>
              <div class="flex-1 text-center bg-gray-300 text-gray-500 px-3 py-2 rounded text-sm cursor-not-allowed">
                <% if template.requires_premium? && !current_business.premium_tier? %>
                  Requires Premium
                <% elsif template.industry != 'universal' && template.industry != current_business.industry %>
                  Different Industry
                <% else %>
                  Unavailable
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Empty State -->
  <div class="text-center py-12 hidden" data-template-browser-target="emptyState">
    <div class="text-gray-400 text-6xl mb-4">🎨</div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">No templates found</h3>
    <p class="text-gray-500">Try a different filter or upgrade your plan to access more templates.</p>
  </div>

  <!-- Preview Modal -->
  <div class="fixed inset-0 bg-black bg-opacity-50 hidden preview-modal-overlay" 
       style="z-index: 9999;"
       data-template-browser-target="previewModal"
       data-action="keydown@window->template-browser#handleKeydown click->template-browser#closePreview">
    <div class="absolute inset-4 bg-white rounded-lg shadow-xl overflow-hidden flex flex-col" data-action="click->template-browser#stopPropagation">
      <div class="bg-gray-100 border-b border-gray-200 p-4 flex justify-between items-center flex-shrink-0">
        <h3 class="text-lg font-semibold">Template Preview</h3>
        <div class="space-x-3">
          <button type="button" 
                  class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors"
                  data-action="click->template-browser#applyCurrentTemplate">
            Apply This Template
          </button>
          <button type="button" 
                  class="text-gray-500 hover:text-gray-700"
                  data-action="click->template-browser#closePreview">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="flex-1 overflow-hidden">
        <iframe class="w-full h-full border-0" data-template-browser-target="previewFrame" src=""></iframe>
      </div>
    </div>
  </div>
</div>



<style>
.template-card {
  transition: transform 0.2s ease-in-out;
}

.template-card:hover {
  transform: translateY(-2px);
}

.filter-tab {
  background-color: transparent;
  color: #6b7280;
}

.filter-tab:hover {
  background-color: #f3f4f6;
  color: #374151;
}

.filter-tab.active {
  background-color: #3b82f6;
  color: white;
}

.template-card.hidden {
  display: none;
}

/* Hide navigation elements when preview modal is open */
.preview-modal-overlay:not(.hidden) ~ * nav,
.preview-modal-overlay:not(.hidden) ~ * .bg-white.border.border-gray-200.rounded-lg.p-1 {
  display: none !important;
}

/* Ensure modal is on top of everything */
.preview-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9999 !important;
}

/* Prevent body scroll when modal is open */
body.modal-open {
  overflow: hidden;
}
</style> 