<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Intelligent Restock Recommendations</h1>
      <p class="text-gray-600 mt-1">AI-powered inventory predictions to prevent stockouts and optimize ordering</p>
    </div>
    <%= link_to "â† Back to Predictive Analytics", business_manager_analytics_predictive_index_path,
                class: "text-blue-600 hover:text-blue-800 font-medium" %>
  </div>

  <!-- Restock Summary -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow p-6">
      <div class="flex items-center justify-between mb-2">
        <p class="text-sm text-gray-600">Immediate Restock Needed</p>
        <div class="bg-red-100 p-2 rounded-lg">
          <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
          </svg>
        </div>
      </div>
      <p class="text-3xl font-bold text-red-600"><%= @restock_summary[:critical_count] %></p>
      <p class="text-sm text-gray-500 mt-1">Products running out soon</p>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
      <div class="flex items-center justify-between mb-2">
        <p class="text-sm text-gray-600">Restock Within 7 Days</p>
        <div class="bg-yellow-100 p-2 rounded-lg">
          <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
      </div>
      <p class="text-3xl font-bold text-yellow-600"><%= @restock_summary[:warning_count] %></p>
      <p class="text-sm text-gray-500 mt-1">Plan orders soon</p>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
      <div class="flex items-center justify-between mb-2">
        <p class="text-sm text-gray-600">Optimal Stock Level</p>
        <div class="bg-green-100 p-2 rounded-lg">
          <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
      </div>
      <p class="text-3xl font-bold text-green-600"><%= @restock_summary[:healthy_count] %></p>
      <p class="text-sm text-gray-500 mt-1">Well-stocked items</p>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
      <div class="flex items-center justify-between mb-2">
        <p class="text-sm text-gray-600">Estimated Order Value</p>
        <div class="bg-blue-100 p-2 rounded-lg">
          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
      </div>
      <p class="text-3xl font-bold text-gray-900"><%= number_to_currency(@restock_summary[:total_order_value]) %></p>
      <p class="text-sm text-gray-500 mt-1">For recommended orders</p>
    </div>
  </div>

  <!-- Priority Restocking -->
  <% if @critical_restocks.present? && @critical_restocks.any? %>
    <div class="bg-white rounded-lg shadow mb-8">
      <div class="px-6 py-4 border-b border-gray-200 bg-red-50">
        <h2 class="text-xl font-semibold text-gray-900 flex items-center">
          <span class="w-3 h-3 rounded-full bg-red-500 mr-3 animate-pulse"></span>
          Critical - Order Immediately
          <span class="ml-3 px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">
            <%= @critical_restocks.count %>
          </span>
        </h2>
        <p class="text-sm text-red-700 mt-1">These products will run out in the next 1-3 days based on current demand</p>
      </div>
      <div class="p-6">
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current Stock</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Days Until Out</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Daily Usage</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recommended Order</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order Value</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% @critical_restocks.each do |product| %>
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900"><%= product[:name] %></div>
                    <div class="text-sm text-gray-500">SKU: <%= product[:sku] %></div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                      <%= product[:current_stock] %> units
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-bold text-red-600"><%= product[:days_until_stockout] %> days</div>
                    <div class="text-xs text-gray-500">Out by <%= product[:predicted_stockout_date].strftime('%b %d') %></div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <%= product[:avg_daily_usage].round(1) %> units/day
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-bold text-blue-600"><%= product[:recommended_order_qty] %> units</div>
                    <div class="text-xs text-gray-500"><%= product[:order_duration_days] %> days supply</div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    <%= number_to_currency(product[:order_value]) %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-right text-sm">
                    <button class="text-blue-600 hover:text-blue-800 font-medium cursor-pointer">Create Order</button>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Upcoming Restocking Needs -->
  <div class="bg-white rounded-lg shadow mb-8">
    <div class="px-6 py-4 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-semibold text-gray-900">Restock Planning (Next 30 Days)</h2>
          <p class="text-sm text-gray-500 mt-1">Products that will need restocking soon</p>
        </div>
        <div class="flex space-x-2">
          <%= link_to 'Export as CSV',
                      export_restock_predictions_business_manager_analytics_predictive_index_path(format: :csv),
                      class: 'px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50' %>
          <%= button_to 'Create Purchase Orders',
                        create_purchase_orders_business_manager_analytics_predictive_index_path,
                        method: :post,
                        class: 'px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700',
                        form_class: 'inline',
                        data: { confirm: 'This will create purchase orders for all recommended restock items. Continue?' } %>
        </div>
      </div>
    </div>
    <div class="p-6">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reorder Point</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Days Remaining</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recommended Qty</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lead Time</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order By</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @restock_recommendations.each do |product| %>
              <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-gray-900"><%= product[:name] %></div>
                  <div class="text-sm text-gray-500">
                    Turnover: <%= product[:turnover_rate].round(1) %>/month
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= stock_level_badge_color(product[:days_until_stockout]) %>">
                    <% if product[:days_until_stockout] <= 3 %>
                      Critical
                    <% elsif product[:days_until_stockout] <= 7 %>
                      Low
                    <% elsif product[:days_until_stockout] <= 14 %>
                      Medium
                    <% else %>
                      Good
                    <% end %>
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  <%= product[:current_stock] %> units
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  <%= product[:reorder_point] %> units
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-gray-900"><%= product[:days_until_stockout] %> days</div>
                  <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                    <% stock_percentage = [(product[:current_stock].to_f / product[:optimal_stock] * 100).round, 100].min %>
                    <div class="<%= stock_percentage > 50 ? 'bg-green-500' : stock_percentage > 25 ? 'bg-yellow-500' : 'bg-red-500' %> h-2 rounded-full"
                         style="width: <%= stock_percentage %>%"></div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-bold text-blue-600"><%= product[:recommended_order_qty] %></div>
                  <div class="text-xs text-gray-500"><%= number_to_currency(product[:order_value]) %></div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  <%= product[:supplier_lead_time] %> days
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-gray-900"><%= product[:order_by_date].strftime('%b %d') %></div>
                  <div class="text-xs <%= product[:days_until_order] <= 3 ? 'text-red-600' : 'text-gray-500' %>">
                    in <%= product[:days_until_order] %> days
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Optimization Insights -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <!-- Overstocked Products -->
    <div class="bg-white rounded-lg shadow">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
          <svg class="w-5 h-5 mr-2 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
          </svg>
          Overstocked Products
        </h3>
        <p class="text-sm text-gray-500 mt-1">Products with excess inventory</p>
      </div>
      <div class="p-6">
        <div class="space-y-3">
          <% @overstocked_products.first(5).each do |product| %>
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <div class="text-sm font-medium text-gray-900"><%= product[:name] %></div>
                <div class="text-xs text-gray-500">
                  <%= product[:current_stock] %> units (<%= product[:days_of_stock] %> days supply)
                </div>
              </div>
              <div class="text-right">
                <div class="text-sm font-medium text-orange-600"><%= product[:excess_percentage] %>%</div>
                <div class="text-xs text-gray-500">over optimal</div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Seasonal Adjustments -->
    <div class="bg-white rounded-lg shadow">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
          <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
          </svg>
          Seasonal Demand Patterns
        </h3>
        <p class="text-sm text-gray-500 mt-1">Upcoming seasonal trends</p>
      </div>
      <div class="p-6">
        <div class="space-y-4">
          <% @seasonal_adjustments.each do |adjustment| %>
            <div class="bg-blue-50 rounded-lg p-4">
              <div class="flex items-start justify-between mb-2">
                <h4 class="text-sm font-medium text-gray-900"><%= adjustment[:season] %></h4>
                <% if adjustment[:timeframe].present? %>
                  <span class="text-xs font-medium text-blue-600"><%= adjustment[:timeframe] %></span>
                <% end %>
              </div>
              <p class="text-sm text-gray-600 mb-3"><%= adjustment[:description] %></p>
              <% if adjustment[:affected_products].present? %>
                <div class="space-y-2">
                  <% adjustment[:affected_products].first(3).each do |product| %>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-700"><%= product[:name] %></span>
                      <span class="font-medium <%= product[:change] >= 0 ? 'text-green-600' : 'text-red-600' %>">
                        <%= product[:change] >= 0 ? '+' : '' %><%= product[:change] %>%
                      </span>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Supplier Performance -->
  <div class="bg-white rounded-lg shadow">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-900">Supplier Performance</h2>
      <p class="text-sm text-gray-500 mt-1">Lead times and reliability metrics</p>
    </div>
    <div class="p-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <% @supplier_performance.each do |supplier| %>
          <div class="border border-gray-200 rounded-lg p-4">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-sm font-medium text-gray-900"><%= supplier[:name] %></h3>
              <span class="px-2 py-1 text-xs font-medium rounded <%= supplier[:reliability_score] >= 95 ? 'bg-green-100 text-green-800' : supplier[:reliability_score] >= 85 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800' %>">
                <%= supplier[:reliability_score] %>%
              </span>
            </div>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600">Avg Lead Time:</span>
                <span class="font-medium text-gray-900"><%= supplier[:avg_lead_time] %> days</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">On-Time Rate:</span>
                <span class="font-medium text-gray-900"><%= supplier[:on_time_delivery_rate] %>%</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Products:</span>
                <span class="font-medium text-gray-900"><%= supplier[:product_count] %></span>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
